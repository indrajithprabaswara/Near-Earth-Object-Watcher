<!DOCTYPE html>
<html>
<head>
<title>NEO Watcher</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.2/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>
<body>
<h1>NEO Watcher Dashboard</h1>
<canvas id="chart"></canvas>
<form id="subForm">
  <input type="url" id="subUrl" placeholder="Webhook URL" required />
  <button type="submit">Subscribe</button>
</form>
<script>
const evtSource = new EventSource('/stream/neos');
const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx, {type:'line', data:{labels:[], datasets:[{label:'NEOs', data:[]}]} });
evtSource.onmessage = function(e){
  const data = JSON.parse(e.data);
  chart.data.labels.push(new Date().toISOString());
  chart.data.datasets[0].data.push(data.length);
  chart.update();
  anime({targets:'h1', scale:[1,1.1], direction:'alternate', duration:500});
};
document.getElementById('subForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const url = document.getElementById('subUrl').value;
  await fetch('/subscribe', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({url})});
  document.getElementById('subUrl').value='';
});
</script>
</body>
</html>
